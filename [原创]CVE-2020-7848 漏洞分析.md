> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [bbs.pediy.com](https://bbs.pediy.com/thread-272488.htm)

> [原创]CVE-2020-7848 漏洞分析

### description

The EFM ipTIME C200 IP Camera is affected by a Command Injection vulnerability in /login.cgi?logout=1 script. To exploit this vulnerability, an attacker can send a GET request that executes arbitrary OS commands via cookie value.

### shodan:

html:LS_CAMINFO_MODEL

### 漏洞设备版本

v1.0.12

### 固件获取

[c200_1_012.bin](https://yanzhichen.top/images/posts_images/CVE-2020-7848/c200_1_012.bin)

### 漏洞分析

通过漏洞描述可知，漏洞发生在 **login.cgi**，使用 **ida** 打开 **login.cgi**，搜索字符串 **“logout”**，然后交叉引用，发现只有主函数存在 **“logout”** 这个字符串，重点看下图位置  
![](https://bbs.pediy.com/upload/attach/202204/762704_2WQVZGABH6RTMMU.png)  
**sub_404770** 的作用是将请求的参数按 “&” 进行分割，获取 logout 参数的值，如果请求中含有 logout 参数且值为 1 则进入 **sub_4062AC** 函数  
![](https://bbs.pediy.com/upload/attach/202204/762704_FSN7AKYGQ5A5U4H.png)  
![](https://bbs.pediy.com/upload/attach/202204/762704_NQZTE8UEGYA4CBB.png)  
在 **sub_4062AC** 函数，首先会获取请求的 cooike 值，如果请求体没有 **HTTP_COOKIE** 这个字段则直接 return，  
![](https://bbs.pediy.com/upload/attach/202204/762704_E7K8479DDNEAA69.png)  
之后会进入 **sub_405BA8** 进行进一步检测，在该函数会首先检测 **HTTP_COOKIE** 是否为空，如果为空则 return，然后会在 cookie 值中搜索 **efm_session_id** 这个字段，如果没有，同样也是直接 return，之后进入 **sub_4024F8** 函数，该函数其实就是一个赋值操作，将 **efm_session_id** 字段的长度为 **17** 的值赋值给 a2，后边的变量 v5 不需要管，对该漏洞无影响。  
![](https://bbs.pediy.com/upload/attach/202204/762704_R6W9YZSW3DX5W4D.png)  
最后进入 **sub_405770** 函数，也就是触发命令执行的地方，重点看红框部分  
它会首先执行 **rm -rf /var/run/{efm_session_id}.lock**  
然后再执行 **rm -rf /var/run/{efm_session_id}**  
![](https://bbs.pediy.com/upload/attach/202204/762704_K9UQR66A4JNXAYB.png)

 

**再总结一下，导致该漏洞的主要原因，其实就是没有对 efm_session_id 做安全性校验。**

 

我的博客: https://yanzhichen.top/

[【公告】 [2022 大礼包]《看雪论坛精华 22 期》发布！收录近 1000 余篇精华优秀文章!](https://bbs.pediy.com/thread-271749.htm)

[#漏洞分析](forum-150-1-153.htm) [#Linux](forum-150-1-161.htm)