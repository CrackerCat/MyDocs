> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [bbs.pediy.com](https://bbs.pediy.com/thread-257796.htm)

cve-2019-2234 组件暴露漏洞分析
----------------------

前几天学长扔给了我个漏洞去玩玩，上午抽空分析了下。

 

这个漏洞的分析整体难度不大，是个组件暴露问题，由 checkmarx 团队发现（说实话感觉这个漏洞有点没意思，大佬就直接掠过吧）

 

问题出现在 google camera 上，影响范围是 pixel2，pixel3 以及三星的部分手机，身边没有该漏洞环境的可复现环境，就在这里分析以下，做个笔记。

 

checkmarx 对此的报道在这：[官方报道即视频演示](https://www.checkmarx.com/blog/how-attackers-could-hijack-your-android-camera)

 

checkmarx 提交漏洞的具体时间表：

 

![](https://bbs.pediy.com/upload/attach/202002/837839_RFZNBDSBYZFDH83.png)

 

所以对应着尽可能地去找 2019.7.4 以前 google camera 的 apk，由于在 PC 端 google play 官网下载不了相应的 apk，需要在其他类似镜像的网站下载，这里我选了在 apkmirror 网上下载 6.14 号更新的 apk

 

![](https://bbs.pediy.com/upload/attach/202002/837839_KKFHH27CSNUF87F.png)

 

直接拖入 jadx。按漏洞信息描述是暴露了以下组件，其他应用可以无需任何权限就调用它。

```
com.google.android.apps.camera.legacy.app.activity.main.CameraActivity
com.android.camera.CameraLauncher
com.android.camera.CameraActivity
com.android.camera.activity.CaptureActivity
com.android.camera.VideoCamera
com.android.camera.CameraImageActivity
com.android.camera.CameraVideoShortcutActivity
com.android.camera.CameraDeepLinkActivity
com.android.camera.SecureCameraActivity
com.google.android.apps.camera.legacy.app.settings.CameraSettingsActivity
com.google.android.apps.camera.legacy.app.refocus.ViewerActivity
com.google.android.apps.camera.photobooth.activity.PhotoboothActivity
com.google.android.libraries.social.licenses.LicenseMenuActivit

```

直接用 jadx 展开显示代码包，发现只有 com.google.android 开头的包名可以直接对应漏洞的描述，可以知道部分组件使用了别名，那就翻看 AndroidManifest.xml。

 

![](https://bbs.pediy.com/upload/attach/202002/837839_ZZNWG92FGW672AZ.png)

 

搜索可以定位这几个别名对应的 targetactivity.

发现对应的别名和 targetactivity 的对应关系是

```
com.android.camera.CameraLauncher -->              com.google.android.apps.camera.legacy.app.activity.main.CameraActivity
 
com.android.camera.CameraActivity -->              com.google.android.apps.camera.legacy.app.activity.main.CameraActivity
 
com.android.camera.activity.CaptureActivity -->    com.google.android.apps.camera.legacy.app.activity.CaptureActivity
 
com.android.camera.VideoCamera -->                 com.google.android.apps.camera.legacy.app.activity.CaptureActivity
 
com.android.camera.CameraImageActivity -->         com.google.android.apps.camera.legacy.app.activity.CameraImageActivity
 
com.android.camera.CameraVideoShortcutActivity --> com.google.android.apps.camera.legacy.app.activity.CameraImageActivity
 
com.android.camera.CameraDeepLinkActivity -->      com.google.android.apps.camera.legacy.app.activity.CameraDeepLinkActivity
 
com.android.camera.SecureCameraActivity -->        com.google.android.apps.camera.legacy.app.activity.SecureCameraActivity

```

加上之前无别名的组件，一共是以下 activity 组件，其中上半部分无别名的组件因为直接 android:exported = "true" 导致组件直接暴露，同时都没有设置 android：permission，下半部分的情况有，android：exported = "ture" 直接暴露的，也有组件原来的 exported 属性是 false，但是 alias 别名对应的组件没有直接设置 exported，但是设置了 intent-filter，即默认 exported 为 true，但是使其响应的 intent 需符合 intent-filter 的所有条件。

```
com.google.android.apps.camera.legacy.app.activity.main.CameraActivity
com.google.android.apps.camera.legacy.app.settings.CameraSettingsActivity
com.google.android.apps.camera.legacy.app.refocus.ViewerActivity
com.google.android.apps.camera.photobooth.activity.PhotoboothActivity
com.google.android.libraries.social.licenses.LicenseMenuActivity
---------------------------------------------------------------------
com.google.android.apps.camera.legacy.app.activity.main.CameraActivity
com.google.android.apps.camera.legacy.app.activity.CaptureActivity
com.google.android.apps.camera.legacy.app.activity.CameraImageActivity
com.google.android.apps.camera.legacy.app.activity.CameraDeepLinkActivity
com.google.android.apps.camera.legacy.app.activity.SecureCameraActivity

```

说实话，分析到这就感觉到这个漏洞原理应该还是比较简单的，因为它的组件暴露可以直接造成个人隐私泄露影响。具体功能逻辑也比较简单，就是有混淆，上 jadx 反混淆，遇到奇葩函数时，去 jeb 里看其 smali 源码，基本上就能摸清程序的逻辑了。

 

其利用举个例子，比如这里的 com.google.android.apps.camera.legacy.app.activity.CameraImageActivity，我们已经知道 com.google.android.apps.camera.legacy.app.activity.main.CameraActivity 是主活动了，代码中的字符串已经暴露了它的用途，具体分析不再累述，而看 CameraImageActivity 发现它是直接调用 CameraActivity 的，所以说我们只要发出符合 CameraImageActivity 的 intent，那么就可以间接启动 CameraActivity 进行拍照等活动了。

*   CameraActivity  
    ![](https://bbs.pediy.com/upload/attach/202002/837839_BWTV3E99D2G5CHA.png)
    
*   CameraImageActivity  
    ![](https://bbs.pediy.com/upload/attach/202002/837839_X43F7X9CR45B4CK.png)
    

再看上面个提到的官方描述时间线，能够体会到该漏洞等级之所以升级也应该得益于 checkmarx 的 exp（即 vuln app）构造的好。

 

看完了一个漏洞，拿一个实例试一下，某订票软件。分析发现其中的一个暴露组件，于是构造 intent，先启动程序，然后查看包名，在附上 android：name。

*   暴露的组件
    
*   确定包名  
    ![](https://bbs.pediy.com/upload/attach/202002/837839_8J6NNMM7VT5W83Z.png)
    
*   发送 intent  
    ![](https://bbs.pediy.com/upload/attach/202002/837839_NXT6SHC8B3946QW.png)
*   2333，居然是个测试组件  
    ![](https://bbs.pediy.com/upload/attach/202002/837839_A9BMG9FFG69TT7P.png)

到这里想起来之前所看过的一个 intent fuzzer，虽然说这工具的威力可能不大（厂商一般都会无视只能引起崩溃的问题），但这里也可当一个工具来学习针对性的 fuzz 了，具体可以看我之前写过的一篇文章

 

[intent fuzz](https://www.anquanke.com/post/id/197083)

 

顺便整理了下其他组件暴露的问题，感觉有点启发，那些组件暴露的问题都只能算是一个切入口，真正鉴定它是否是一个漏洞的标准取决于应用自身的逻辑（即是否是一些敏感功能），颇有点像一条路径上的各个分叉，看顺着分叉能够达到的程度大小就差不多决定了这是否是个漏洞，只不过上面这个漏洞的分支程度不深（一个转换就可以（怪不得这洞没人分析 orz））。

[安卓应用层抓包通杀脚本发布！《高研班》2021 年 3 月班开始招生！](https://bbs.pediy.com/thread-264283.htm)